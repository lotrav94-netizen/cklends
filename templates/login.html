<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CK Mortgage â€“ Log In / Create Account</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f6fa;
        }
        .text-green { color: #19A74A !important; }
        .text-purple { color: #8C54A1 !important; }
        .bg-black { background: #161616 !important; }
        .btn-green {
            background: #19A74A;
            color: rgb(80, 80, 80) !important;
            border: none;
        }
        .btn-green:hover { background: #128037; }
        .btn-purple {
            background: #8C54A1;
            color: white !important;
            border: none;
        }
        .btn-purple:hover { background: #6a387f; }
        .card-black { background: #161616; color: white !important; }
        input.form-control, .form-label {
            border-radius: 0.3rem !important;
        }
        .center-box {
            max-width: 420px;
            margin: 5rem auto;
            padding: 2rem 2.5rem;
            background: #fff;
            box-shadow: 0 2px 16px rgba(25,167,74,0.10);
            border-radius: 1rem;
        }
        .toggle-link {
            color: #8C54A1;
            cursor: pointer;
            text-decoration: underline;
        }
        .toggle-link:hover {
            color: #19A74A;
        }
        .alert-box {
            text-align: center;
            margin-bottom: 15px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-black">
        <div class="container-fluid">
            <a class="navbar-brand text-green" href="#">CK Mortgage</a>
        </div>
    </nav>

    <div class="center-box">
        <h2 class="text-center text-green mb-4" id="form-title">Log In</h2>
        <div id="alert" class="alert-box"></div>

        <!-- Login Form -->
        <form id="login-form" autocomplete="off">
            <div class="mb-3">
                <label class="form-label text-purple" for="login-username">Username</label>
                <input type="text" class="form-control" id="login-username" required>
            </div>
            <div class="mb-3">
                <label class="form-label text-purple" for="login-password">Password</label>
                <input type="password" class="form-control" id="login-password" required>
            </div>
            <button type="submit" class="btn btn-green w-100 mb-2">Log In</button>
        </form>

        <!-- Create Account Form -->
        <form id="create-form" style="display: none;" autocomplete="off">
            <div class="mb-3">
                <label class="form-label text-purple" for="create-username">Username</label>
                <input type="text" class="form-control" id="create-username" required>
            </div>
            <div class="mb-3">
                <label class="form-label text-purple" for="create-email">Email address</label>
                <input type="email" class="form-control" id="create-email" required>
            </div>
            <div class="mb-3">
                <label class="form-label text-purple" for="create-password">Password</label>
                <input type="password" class="form-control" id="create-password" required>
            </div>
            <div class="mb-3">
                <label class="form-label text-purple" for="create-confirm">Confirm Password</label>
                <input type="password" class="form-control" id="create-confirm" required>
            </div>
            <button type="submit" class="btn btn-purple w-100 mb-2">Create Account</button>
        </form>

        <!-- Toggle Links -->
        <div class="text-center mt-3">
            <span class="toggle-link" id="toggle-create">Create an Account</span>
            <span class="toggle-link" id="toggle-login" style="display:none;">Already have an account? Log in</span>
        </div>
    </div>

    <footer class="footer bg-black text-white py-4 mt-5">
        <div class="container text-center">
            &copy; 2025 CK Mortgage (NMLS #2387222) | All rights reserved.
        </div>
    </footer>

    <script>
        // Toggle between forms
        document.getElementById('toggle-create').onclick = function() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('create-form').style.display = 'block';
            document.getElementById('form-title').innerText = 'Create Account';
            this.style.display = 'none';
            document.getElementById('toggle-login').style.display = 'inline';
        };

        document.getElementById('toggle-login').onclick = function() {
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('create-form').style.display = 'none';
            document.getElementById('form-title').innerText = 'Log In';
            this.style.display = 'none';
            document.getElementById('toggle-create').style.display = 'inline';
        };

        // Show alert
        function showAlert(message, color='red') {
            const alertDiv = document.getElementById('alert');
            alertDiv.textContent = message;
            alertDiv.style.color = color;
            alertDiv.style.display = 'block';
            setTimeout(() => alertDiv.style.display = 'none', 3000);
        }

        // Login
        document.getElementById('login-form').onsubmit = async function(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            const res = await fetch('http://127.0.0.1:5000/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, password})
            });

            const data = await res.json();
            if (res.ok) {
                localStorage.setItem('token', data.access_token);
                showAlert('Login successful!', 'green');
                setTimeout(() => window.location.href = '/dashboard.html', 1500);
            } else showAlert(data.message || 'Invalid login details');
        };

        // Register
        document.getElementById('create-form').onsubmit = async function(e) {
            e.preventDefault();
            const username = document.getElementById('create-username').value;
            const email = document.getElementById('create-email').value;
            const password = document.getElementById('create-password').value;
            const confirm = document.getElementById('create-confirm').value;

            if (password !== confirm) return showAlert('Passwords do not match');

            const res = await fetch('http://127.0.0.1:5000/api/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, email, password})
            });

            const data = await res.json();
            if (res.ok) {
                showAlert('Account created! You may log in now.', 'green');
                document.getElementById('toggle-login').click();
            } else showAlert(data.message || 'Registration failed');
        };
    </script>
</body>
</html>
